<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>
 	<link href="stylesheet/a.screen.css" rel="stylesheet" type="text/css" media="screen, projection"/>
	<!--[if lt IE 7]>
	  <link href="stylesheet/b.ie.css" rel="stylesheet" type="text/css" media="screen, projection" />
	<![endif]-->
 	<link href="stylesheet/c.styles.css"rel="stylesheet" type="text/css" media="screen, projection"/>
</head>
<body>
	<div class="container">
		<div id="cal_wrapper" class="span-21 prepend-2">
			<div id="cal_header" class="span-19">
				<div class="calheading first weekend">Sun</div>
				<div class="calheading">Mon</div>
				<div class="calheading">Tue</div>
				<div class="calheading">Wed</div>
				<div class="calheading">Thu</div>
				<div class="calheading">Fri</div>
				<div class="calheading weekend">Sat</div>
			</div>
			<div id="cal_body" class="span-19">
				<div class="span-6">
					<div class="this-month-year">
						<h1 class="this-month">January</h1>
						<h2 class='this-year'>2015</h2>
					</div>
					<p id="today_date">January 11, 2015</p>
					<img id="today_date_img" width="229" src="http://www.kidsmathgamesonline.com/images/pictures/numbers600/number11.jpg">
					<p id="today_caption">Title: <b>Number 11</b> - Free Picture of the <b>Number</b> Eleven</p>
					<p id="today_source">Source: www.kidsmathgamesonline.com</p>
				</div>
				<div id="cal_datecell">
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_1 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcRFiX7E9OvGHFPo3JetrqJK8XcJftDGa0V39V470RvIAA0xtleWCq5fI2A);">1</div>
					<div class="cal_day d_2 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcTgGXXoKu8EeWY_D66pqNFq2TzYdQz_6YXMxLJ9qQkL9uiWXTSzo4crv-3G);">2</div>
					<div class="cal_day d_3 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcQZk3_p8QtH2MJPI33O6kLFLwGptjvOEN1QhCYwqrVs37HUfJHEI5ePBvSR);">3</div>
					<div class="cal_day d_4 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcTWFdo6NXVy_fQkQY7FbnmZPkpiSN1ioePVbxeppRVW0kUGbH6PInWI3DM);">4</div>
					<div class="cal_day d_5 cal_cellsetting" style="background-image: url(http://t3.gstatic.com/images?q=tbn:ANd9GcTEGV6BsSFVdnA5crcKTxLc7QjR-gPOlCsmuis9DWyO1xWqBUA_QUNKbQQ);">5</div>
					<div class="cal_day d_6 cal_cellsetting">6</div>
					<div class="cal_day d_7 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcSkAezqWxAbIcCvNl7z42K9AIcxCWI31zH6plcWN8sI6Fq-EJ7b_cLcbU-fAw);">7</div>
					<div class="cal_day d_8 cal_cellsetting" style="background-image: url(http://t3.gstatic.com/images?q=tbn:ANd9GcSvr6PI9nRd7CnKuKpXGe7tKC8C54FM-cl2Ycl4ZsptIRZsMh6I8sXWUsSo0w);">8</div>
					<div class="cal_day d_9 cal_cellsetting" style="background-image: url(http://t0.gstatic.com/images?q=tbn:ANd9GcSY-wlmy8eXZIqgSxTsLdzhSWAaioS3llo9TyJQq19OAH1o0VXkmeuMWZ0I);">9</div>
					<div class="cal_day d_10 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcR8oBwmB8oM1a-VRLD0-M1Q2tyepU4AECYYInrdS1KzbO7H4taNYDG9QqwI);">10</div>
					<div class="cal_day today d_11" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcTB3AuEN1pkX2OXAOJ5-7o263g2I1RupDWEoWrWRgYuizR_CJUlUYdwi9XpxA);">11</div>
					<div class="cal_day d_12 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcS4akjHU4fpMnbj_7hBf21qEmNrzsaYEfZDFzHSRNeqUhvU03QY0FYTPMxTbg);">12</div>
					<div class="cal_day d_13 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcRol71md5M-vLVOFOXTYkk1Wn3ux3N3FMI2WlhqgmHyLoaSjAMjPinyY2aIdA);">13</div>
					<div class="cal_day d_14 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcRP-tuk71NdfLh2bDfAg-s33ie-mpNU3kWottbHSdpwuAjGjUnxT645hQl7);">14</div>
					<div class="cal_day d_15 cal_cellsetting" style="background-image: url(http://t0.gstatic.com/images?q=tbn:ANd9GcSf1AhfWn4WuOcqha38H7qnhDTg3NH_ZmtyetOo0uYwDjMAHzk2UYCzWfA);">15</div>
					<div class="cal_day d_16 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcQH8V680up73ZbnQO9XfhZOoNOK2K0XNeKOP9PLsywC68QKZaaWh6tUn5jO);">16</div>
					<div class="cal_day d_17 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcQ1wR5bfceG68MxcQWiB0FeAbUZGiYVvoPUwmMhp_Qs0QqRsZeHDF1KQ0wJLg);">17</div>
					<div class="cal_day d_18 cal_cellsetting" style="background-image: url(http://t3.gstatic.com/images?q=tbn:ANd9GcSmNLZh7F16uJJrhYpTJcICwornF414D8nCPnh_TS2k3v1CwJ0UMXjvB5rJ);">18</div>
					<div class="cal_day d_19 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcQjb8LU7hBpx18CcmWaye3gpPfWoLXEMloqzF7kbnGbYpca0ZK3nQnU7w4GEA);">19</div>
					<div class="cal_day d_20 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcTVexibiTK7K9GbjJv0aoCTW3k4AwxVhJdbiS6dZ7YtPB1b84ymDt6cQQlhOA);">20</div>
					<div class="cal_day d_21 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcRRh6Aoawm8cIvYeQu_bH0EVfGkoqW5N4cRl-dC3IvYIz_hf5x8P__dvg);">21</div>
					<div class="cal_day d_22 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcR8CQYUd-8pqF1NpX4NHc47YdOetP0jQ-JiOriwYQrEF-P_kAqI-rGkRG4);">22</div>
					<div class="cal_day d_23 cal_cellsetting" style="background-image: url(http://t3.gstatic.com/images?q=tbn:ANd9GcTH60ty9TnbICkjJ_pSOSEol8VWZPb-eFdwZFNkGZFGMDywX9dB5J3FkL0);">23</div>
					<div class="cal_day d_24 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcR8LRZNpYrmR3hO333bDFUuRovRHL-7rrhu7sb8rPjI69a_j5QS_ja16XJp);">24</div>
					<div class="cal_day d_25 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcReEmwK6dNM8t9FBaqJ0ct8Dp4tYoImHgQ_Bu_z7MAsEWqY5NgRb-gb7Us);">25</div>
					<div class="cal_day d_26 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcS0QsHiKgkHDtbAQnhFjPn5fj6ZBSup4gMiGkrGKnP2nOM96zvs2pHcAN-sKg);">26</div>
					<div class="cal_day d_27 cal_cellsetting" style="background-image: url(http://t3.gstatic.com/images?q=tbn:ANd9GcTw4NGocPVYkez4_hyxJTpd4KskmQBxaVyzny40EB4chKmySOHH2ZqjP3M);">27</div>
					<div class="cal_day d_28 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcS_jWYnF2Uf3LXEZmSY1tNZju93YEyc7N_smo5xROb_pS1pss6sBJWh-P72vA);">28</div>
					<div class="cal_day d_29 cal_cellsetting" style="background-image: url(http://t2.gstatic.com/images?q=tbn:ANd9GcRwXHOkVHlwiUYXS1WJ2R2FWHGs92ih6ovnuwXbrzBktdET-Rdp8eIbpQ);">29</div>
					<div class="cal_day d_30 cal_cellsetting" style="background-image: url(http://t1.gstatic.com/images?q=tbn:ANd9GcQitn-uxzTmJFx5AxyVFBzCN9KhMAfkb8dPiVi7qa09Lj52gIgvK89Xbhyh);">30</div>
					<div class="cal_day d_31 cal_cellsetting" style="background-image: url(http://t3.gstatic.com/images?q=tbn:ANd9GcQqqkf2DMdc04QzYwrMbhJmQTmSTCv-u1j7c4fDqC5QWPeMgFEAgKZHREo);">31</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
					<div class="cal_day d_&nbsp; cal_cellsetting">&nbsp;</div>
				</div>
			</div>
		</div>
	</div>
</body>
	<script type="text/javascript">
	/* todo:
		1. use same image for small-large today date.
		2. filter (square images only!?) to crop  properly.
	*/
	$(document).ready(function(){
		var todaydate=new Date();
		var curmonth=todaydate.getMonth()+1 //get current month (1-12)
		var curyear=todaydate.getFullYear() //get current year
		//$('#cal_wrapper').append(buildCal(curmonth,curyear));

		var todaySearchDate = todaydate.getDate();
		var todaySearchTerm = "number " + todaySearchDate;
		var todayRequestURL = constructReQuestURL(todaySearchTerm);
		requestImage(todayRequestURL,'forToday',0);
		var searchTerm = "number 0";
		for(i=1;i<=31;i++) {
			searchTerm = searchTerm.substr(0,7).concat(i);
			requestUrl = constructReQuestURL(searchTerm);
			requestImage(requestUrl,'forOtherDays',i)
		}
	});

	buildCal = function(m,y){
		var month=['January','February','March','April','May','June','July','August','September','October','November','December'];
		var dim=[31,0,31,30,31,30,31,31,30,31,30,31];
		var date = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
		var oD = new Date(y, m-1, 1); //DD replaced line to fix date bug when current day is 31st
		oD.od=oD.getDay()+1; //DD replaced line to fix date bug when current day is 31st

		var todaydate=new Date() //DD added
		var scanfortoday=(y==todaydate.getFullYear() && m==todaydate.getMonth()+1)? todaydate.getDate() : 0 //DD added
		dim[1]=(((oD.getFullYear()%100!=0)&&(oD.getFullYear()%4==0))||(oD.getFullYear()%400==0))?29:28;

		// output header
		var html='<div id="cal_header" class="span-19">';
		for(i=0;i<7;i++)
			//console.log(date[i])
			switch(date[i]) {
				case 'Sun': html+='<div class="calheading first weekend">'+date[i]+'</div>';
					break;
				case 'Sat': html+='<div class="calheading weekend">'+date[i]+'</div>';
					break;
				default: html+='<div class="calheading">'+date[i]+'</div>';
			}
		html+='</div>';

		//output body
		var d=new Date();
		var strDate = month[m-1]+' '+d.getDate()+', '+y;

		html+='<div id="cal_body" class="span-19">';
		html+='<div class="span-6">';
		html+='<div class="this-month-year"><h1 class="this-month">' + month[m-1]+ '</h1>';
		html+='<h2 class="this-year">' + y + '</h2></div>';
		html+='<p id="today_date">'+strDate+'</p>';
		html+='<img id="today_date_img" width="229"/>';
		html+='<p id="today_caption">Title:</p>';
		html+='<p id="today_source">Image source:</p>';
		html+='</div>';

		//output date
		html+='<div id="cal_datecell">';
		for(i=1;i<=42;i++){
			var x=((i-oD.od>=0)&&(i-oD.od<dim[m-1]))? i-oD.od+1 : '&nbsp;';
			if (x==scanfortoday) {
				html+='<div class="cal_day today '+'d_'+x+'">';
			} else {
				html+='<div class="cal_day '+'d_'+x+' cal_cellsetting">';
			}
			html+= x+'</div>';
		}
		html+='</div></div>'
		return html;
	}

	// create reuqest query
	constructReQuestURL = function (searchTerm) {
		var URL = "http://ajax.googleapis.com/ajax/services/search/images" +
			"?v=1.0" +
			"&q=" + searchTerm +
			"&rsz=3" +
			"&callback=?"
		return encodeURI(URL);
	}

	requestImage = function(requestURL,forWhat,callNum) {
		$.getJSON(requestURL,
			function(data){
				// console.log(data);
				var numRand = Math.floor(Math.random()*(data.responseData.results.length+1));
				$.each(data.responseData.results, function(i,result){
					if(i == numRand) {
						switch (forWhat) {
							// today layout requires a large image, its title and source
							case 'forToday' : {
								// console.log(result.url);
								// console.log(result.title)
								// console.log(result.visibleUrl);

								// var imgSource = result.MediaUrl.split('/');
								$("#cal_body > div > #today_date_img").attr('src',result.url);
								$("#cal_body > div > #today_caption").html('Title: ' + result.title);

								//trim the URL after domain name
								$("#cal_body > div > #today_source").html('Source: ' + result.visibleUrl);
							break
							}
							// other days require thumbnail
							case 'forOtherDays': {
								//console.log(result.Thumbnail.Url);
								calClass = '.d_' + callNum;
								$(calClass).css({'background-image':'url('+result.tbUrl+')'});
							break;
							}
						} // end switch
					}
				}); // end each
		}); // end getJSON
	}
	</script>